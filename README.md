<p align="center">
  <img src="./public/resources/icons/logo.png"></img>
</p>

<h1 align="center">GT-DB</h1>
<h3 align="center">Eine Büchereimanagement Web-App für das Gymnasium Trittau</h3>

# Features
<ul>
  <li>Ausleihstatus in Echtzeit</li>
  <li>Benutzerkonten</li>
  <li>Mehrere Berechtigungsebenen</li>
  <li>Suchfunktion</li>
  <li>Modernes, schlichtes Design</li>
</ul>

# Gliederung
[Changelog](#changelog)</br>
[Anleitung](#anleitung)</br>
[Installation](#installation)

# <a name="changelog"></a> Changelog
#### 23.11.2021
<b>Neues Feature:</b> Die Suchfunktion unterstützt nun die direkte Suche eines Begriffs in einer bestimmten Kategorie. Beispielsweise per Link.

# <a name="anleitung"></a> Anleitung

### Registrieren und Anmelden

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139346140-c68f1179-7523-45bc-91ad-9571362e87e7.png">
</p>
<p align="center">
  Dies ist die Startseite. 
</p>
<p align="center">
Wenn ihr schon einen Account habt, könnt ihr euch auf dieser Seite mit eurem Benutzernamen oder eurer Email und Passwort einloggen.
Wenn ihr euer Passwort vergessen habt, klickt den Link "Passwort vergessen ?" unten links.
Zum Registrieren öffnet den Link "Registrieren" unten rechts.
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139346386-74c2bfb7-d4f8-4ed7-a999-1e9d59c1a03d.png">
</p>
<p align="center">
  Hier seht ihr das Registrierungsformular. 
</p>
<p align="center">
  Füllt es mit eurer iServ-Emailadresse und Passwort aus und ihr seid startklar.
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139346681-bd2e7eca-5722-44c3-a4c8-b04e778c6ce8.png">
</p>
<p align="center">
  Wenn ihr euch erfolgreich registriert habt, seht ihr diese Info und könnt euch mit eurem angezeigten Benutzernamen oder eurer Email einloggen.
  Der Benutzername wird klein geschrieben und ist in der Regel euer Vorname und Nachname getrennt durch einen Punkt, so wie in eurer iServ-Email.
</p>

#

### Dashboard

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139350109-9ed452f9-3854-4d27-a4d6-df530565da75.png">
</p>
<p align="center">
  Das ist das Dashboard, wo ihr die Status von ausgelaufenden Ausleihen und bald auslaufenden Ausleihen sehen könnt. Für die Zukunft ist noch eine Funktion zum halbautomatischen Senden von Emails an Personen mit ausgelaufenden und bald auslaufenden Ausleihen geplant.
  Darunter habt ihr eine Suchfunktion, womit ihr nach allem suchen könnt, sei es ein Buchname, Autorname, Genre oder ISBN.
  Die Tabelle ist eine zufällige Auswahl an Büchern, die als Anregung oder Inspiration dienen soll.
  Über den Button "Alle Bücher" werdet ihr zu einer Seite weitergeleitet, die euch alle eingetragenen Bücher anzeigt.
</p>

#

### Sidebar

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139352446-64887418-6023-4753-8f97-344e8fde4d44.png">
</p>

<p align="center">
  Eine Sidebar zur Navigation zwischen den Bereichen könnt ihr mit den zwei Strichen oben links in der Ecke ausklappen.
Dort seht ihr dann im Optimalfall euer Profilbild, Namen und Links zu den verschiedenen Bereichen. 
</p>

#

### Suchfunktion

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139354864-c722a264-c45f-4718-84a6-e93b0d7d76f0.png">
</p>
<p align="center">
  Zum Suchen tippt ihr einen Begriff in die Suchleiste und klickt auf die jeweilige gewünschte Suchkategorie.
</p>

#

### Alle Bücher

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139350694-4902e97d-8a1d-4eac-b0ff-c2185dd5c978.png">
</p>
<p align="center">
  Die Tabelle mit allen Einträgen zeigt euch verschiedene Informationen auf einen Blick. Beispielsweise ob ein Buch zur Zeit verfügbar ist, durch einen grünen oder roten Kreis für verfügbar oder nicht verfügbar.
  Wenn ihr auf den Buchnamen klickt, werdet ihr zur Buch-eigenen Seite weitergeleitet, zu der ich gleich komme.
Wenn ihr jedoch auf einen Link in der Spalte "Genre" oder "Autor" klickt, werdet ihr zur Suche weitergeleitet, die euch alle Bücher mit dieser Eigenschaft liefert.
</p>

#

### Individuelle Buchseite - Ausleihen und Zurückgeben

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139354276-ae3c8fed-2167-473b-a08a-cc0ddba9327c.png">
</p>
<p align="center">
  So sieht eine Buchseite aus. Hier könnt ihr mit dem Stift oben rechts Eigenschaften eines Buches bearbeiten oder - wie in diesem Fall - ergänzen.
  Wenn ein Buch verfügbar ist, also wenn weniger Exemplare ausgeliehen wurden als eingetragen sind, hat das Cover eine grüne Umrandung. 
  Unterhalb seht ihr die Ausleihhistorie des Buches, also von wem aus welcher Klasse das Buch von wann bis wann ausgeliehen wurde.
</p>
<p align="center">
  Um ein Buch an jemanden auszuleihen, gebt in die Felder Name und Klasse der Person ein und klickt auf ausleihen. Das angezeigte Datum ist immer das Aktuelle, kann aber auch geändert werden, falls im Nachhinein Einträge angelegt werden.
</p>
<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139352017-3ceda818-b401-4780-85ef-ac0f51ec5f07.png">
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139352074-8026b595-fbd3-494a-9066-eb661fb3886e.png">
</p>

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139352348-9c4edc41-f7f3-45cc-b5b0-7a3ad5ebd500.png">
</p>

<p align="center">
  Wenn ein Buch also ausgeliehen wurde und nicht mehr verfügbar ist, sieht die Seite so aus.
In der Ausleihhistorie ist nun eingetragen, was ihr zuvor eingegeben habt.
Mit dem eingekreisten Kreuz könnt ihr die Ausleihe beenden, wenn das Buch zurückgegeben wurde.
  Gut zu wissen ist hierbei, dass der Status in Echtzeit mit allen Geräten, die dieses Buch anschauen synchronisiert wird, sodass es nicht vorkommen kann, dass ihr ein Buch verleiht, dass kurz zuvor durch jemand anders verliehen wurde. Hilfreich ist das auch, wenn man mit mehreren Leuten viele Bücher auf einmal eintragen möchte.
</p>

#

### Buch hinzufügen

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139352593-3de00185-cda5-4551-8efd-61d403b0409a.png">
</p>
<p align="center">
  Hier könnt ihr neue Bücher eintragen. Ihr müsst alles ausfüllen, bis auf die ISBN, die ist optional. Anschließend "Hinzufügen" klicken.
  Wenn ihr ein Buch hinzufügen möchtet, was schon vorhanden ist, also zum Beispiel ein zweites "Die Drei ??? - Geisterinsel", dann tut das über die bucheigene Seite, dort könnt ihr die Anzahl des Büches anpassen.
</p>

#

### Administration

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139354036-25271b96-421d-4a15-baec-0575e32d07c5.png">
</p>
<p align="center">
  Hier seht ihr alle registrierten Benutzer und könnt ihnen den Zugriff gestatten oder verweigern. Dies wird durch die Regler neben "Manager" kontrolliert.
  Standardmäßig haben neu registrierte Benutzer die Rolle "Manager" nicht, das kann aber durch einen Klick geändert werden.
</p>

#

### Einstellungen

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139354060-2532bca0-a3bb-46cd-8804-b1723eb06b12.png">
</p>
<p align="center">
  In den Einstellungen könnt ihr eurer Passwort ändern und ein Profilbild festlegen.
</p>

#

### Abmelden

<p align="center">
  <img src="https://user-images.githubusercontent.com/56320300/139354147-757bded5-4cc1-4a15-b773-b45160217fc9.png">
</p>
<p align="center">
  Abmelden könnt ihr euch durch diesen Button oben rechts in der Ecke.
</p>
<p align="center">
  Die Tour durch die App endet hier.
</p>


# <a name="installation"></a> Installation
Das Ziel dieser Anleitung ist es, alle Programme so zu installieren und einzustellen, dass die Software autark läuft.
Konkret heißt das, dass im Falle eines Neustarts die Programme von selbst gestartet werden und kein weiterer Benutzereingriff notwendig ist.
Für diese Anleitung nutze ich Ubuntu Server 20.04 als Betriebssystem.</br>
Drei Programme werden benötigt:
- Git
- MongoDB
- Docker
- Docker Compose

### Pakete aktualisieren 

Nutzen Sie `sudo apt update && sudo apt upgrade` um sich zu vergewissern, dass Paketlisten und Pakete auf dem neuesten Stand sind. 

### Docker installieren:

Führen Sie `sudo apt install docker` aus.

### Docker Compose installieren:

Führen Sie `sudo apt install docker-compose` aus.

### MongoDB installieren:

Befolgen Sie <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener noreferrer">diese Anleitung.</a>

### Klonen des Quellcodes:

Führen Sie `git clone https://github.com/KnechtNoobrecht/gt-db_public.git` in einem Verzeichnis Ihrer Wahl aus.

### Erstellen der .env-Datei:

Navigieren Sie in das Verzeichnis, in das Sie den Quellcode geklont haben. </br>
Öffnen Sie den Ordner `gt-db_public`. </br>
Erstellen Sie eine `.env`-Datei mit einem Text-Editor Ihrer Wahl.</br>
Ein Beispiel: Führen Sie `nano .env` aus.</br>
Anschließend erstellen Sie vier Einträge.

1. `DBPASSWORDLOCAL`</br>
    Dies ist das Passwort mit dem sich die Webapp zur Datenbank verbindet.
    Sie können es selbst wählen, verwenden Sie jedoch ausschließlich alphanumerische Zeichen.
    
    Beispiel: `DBPASSWORDLOCAL="A6yzNShCTCe8mzVP"`
2. `DBUSER`</br>
    Dieser Eintrag muss zwingend wie folgt sein:
    `DBUSER="superuser"`
3. `IPADDRESS`</br>
    Die IP-Addresse, unter der die Datenbank läuft, zu der sich die Webapp verbindet
    
    Beispiel: `IP_ADDRESS="localhost"`
5. `SRVPORT`</br>
    Der Port unter dem der Webserver läuft.
    Zu Testzwecken empfehle ich, einen Port zu wählen, der nicht `80` oder `443` ist, da Linux diese Standardmäßig blockiert, beziehungsweise Adminrechte erfordern,        was aber nicht praktikabel ist.
    
    Beispiel: `SRVPORT="4434"`
6. `COOKIESECRET`</br>
   Ein Passwort, mit dem die Cookies verschlüsselt werden.
   
   Beispiel: `COOKIESECRET="5Ut18QEnbjTzv2hH"`
7. `LASTUPDATE`</br>
   Diese Variable wird bei jedem Update durch den Zeitpunkt des Updates ersetzt.
   
   Sie kann als `LASTUPDATE=""` definiert werden, ist aber zwingend erforderlich.
    
### MongoDB konfigurieren:
In dem Installationsverzeichnis `gt-db_public` erstellen Sie den Ordner `db` (oder nennen Sie ihn wie Sie möchten) indem Sie `mkdir db` ausführen.</br>
Anschließend führen Sie `sudo chown -R mongodb:mongodb  /pfad/zu/ihrem/datenbankordner` aus, wobei sie `/pfad/zu/ihrem/datenbankordner` mit dem absoluten Pfad zu Ihrem eben erstellten Datenbankordner ersetzen.</br>
Sie haben bereits ein Passwort für MongoDB ausgesucht.</br>
Nun sichern Sie die Datenbank mit diesem Passwort.</br>
Dazu starten Sie die Datenbank mit folgendem Befehl: `mongod --dbpath="./db"`, vorrausgesetzt Sie befinden sich in dem Ordner `gt-db_public`.</br>
Anschließend verbinden Sie sich zur Datenbank, indem Sie `mongo localhost` ausführen. Ersetzen Sie dabei `localhost` durch eine entsprechende IP-Adresse, falls Sie von einem anderen Computer zugreifen.</br>
</br>
Wechseln Sie mit `use admin` zur admin Datenbank.</br>
Anschließend nutzen Sie folgenden Befehl, wobei Sie `changeMeToAStrongPassword` mit Ihrem Passwort ersetzen:
```
db.createUser(
  {
    user: "superuser",
    pwd: "changeMeToAStrongPassword",
    roles: [ "root" ]
  }
)
```
Als letztes muss noch ein Text-Index erstellt werden.</br>
Dies tun Sie, indem Sie `use gt-db` gefolgt von</br>`db.books.createIndex({name:"text", description:"text"}, {default_language: "german"})` ausführen.</br>
Mit `exit` schließen Sie das Ganze ab.</br>
Bei Problemen lesen Sie bitte <a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/" target="_blank" rel="noopener noreferrer">diesen Artikel.</a></br>

Um zu vermeiden, dass Benutzereingriffe nötig sind, müssen Änderungen an der Konfigurationsdatei vorgenommen werden.</br>
Dazu führen Sie `sudo nano /etc/mongod.conf` aus.</br>

In dieser Datei ändern Sie `dbpath` zu dem absoluten Pfad zu Ihrem Datenbank-Verzeichnis.</br>
Zum Beispiel: `dbpath: /home/julius/gt-db_public/db`</br>
</br>
Außerdem muss die Zeile `#security:` zu `security:` verändert werden, und in der Zeile darunter `authorization: "enabled"` eingefügt werden.
Somit nutzt MongoDB das von Ihnen erstellte Passwort.</br>
Das Endprodukt sollte wie folgt aussehen:</br>
![code snippet](https://user-images.githubusercontent.com/56320300/123632124-dc7da000-d817-11eb-99ec-f0f52848df88.png)
Damit ist die Einrichtung der Datenbank abgeschlossen.

### Zertifikat und Private Key generieren:
Lesen Sie <a href="https://www.ryangeddes.com/how-to-guides/linux/how-to-create-a-self-signed-ssl-certificate-on-linux/" target="_blank" rel="noopener noreferrer">diesen Artikel.</a>

### Node.js App einrichten:
Auf einigen Systemen ist es möglich, dass folgende Befehle nötig sind, um zu gewährleisten, dass Docker ordnungsgemäß funktioniert: 
```
sudo chown $USER /var/run/docker.sock
usermod -G docker $USER
```
Navigieren Sie in den Ordner `gt-db_public` und führen Sie `npm install` aus. </br>
Anschließend führen Sie `docker-compose up` aus und die App wird gestartet.

### Docker und MongoDB beim Systemstart automatisch starten lassen:
Docker: `sudo systemctl enable docker`</br>
MongoDB: `sudo systemctl enable mongod`
